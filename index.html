<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Base Maze - Speed Run</title>
    
    <meta property="og:title" content="Base Maze: Speed Run" />
    <meta property="og:description" content="Can you beat the 35s timer? Play the infinite maze on Base." />
    <meta property="og:image" content="https://cryptologos.cc/logos/base-base-logo.png" />
    <meta property="fc:frame" content="vNext" />
    <meta property="fc:frame:image" content="https://cryptologos.cc/logos/base-base-logo.png" />
    <meta property="fc:frame:button:1" content="Play Game üéÆ" />

    <style>
        * {
            box-sizing: border-box;
            -webkit-user-select: none;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background-color: #0f172a;
            color: white;
            font-family: 'Courier New', Courier, monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
            touch-action: none;
        }

        #game-container {
            position: relative;
            border: 2px solid #334155;
            border-radius: 8px;
            padding: 2px;
            background: #1e293b;
            box-shadow: 0 0 15px rgba(0,0,0,0.5);
            max-width: 95vw;
            max-height: 55vh; 
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #grid {
            display: grid;
            gap: 0;
        }

        .cell { background-color: #0f172a; }
        .wall { background-color: #475569; }
        
        .player {
            background-color: #22c55e;
            border-radius: 50%;
            transform: scale(0.8);
            box-shadow: 0 0 5px #22c55e;
        }
        .goal {
            background-color: #fbbf24;
            transform: scale(0.8);
            box-shadow: 0 0 5px #fbbf24;
            animation: pulse 1s infinite;
        }

        #ui {
            width: 90%;
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 1.1rem;
            font-weight: bold;
        }
        .timer { color: #fbbf24; }
        .danger { color: #ef4444; }

        #controls {
            margin-top: 15px;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            width: 200px;
        }

        .btn-ctrl {
            width: 60px;
            height: 60px;
            background: #334155;
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 0 #1e293b;
        }
        .btn-ctrl:active {
            background: #2563eb;
            box-shadow: none;
            transform: translateY(4px);
        }

        #modal {
            display: none;
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.9);
            z-index: 50;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 20px;
        }
        
        .btn-share {
            background-color: #855DCD;
            color: white;
            padding: 15px 30px;
            border-radius: 25px;
            text-decoration: none;
            font-weight: bold;
            margin-top: 15px;
            display: inline-block;
            font-size: 18px;
            box-shadow: 0 0 15px rgba(133, 93, 205, 0.5);
            border: 2px solid #a78bfa;
        }

        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.6; } 100% { opacity: 1; } }
    </style>
</head>
<body>

    <div id="ui">
        <span style="color: #3b82f6">Lvl <span id="level-display">1</span></span>
        <span class="timer">‚è≥ <span id="time-display">35</span>s</span>
    </div>

    <div id="game-container">
        <div id="grid"></div>
        
        <div id="modal">
            <h2 style="color: #ef4444; margin:0; font-size: 2.5rem;">GAME OVER</h2>
            <p style="font-size: 1.2rem; margin: 10px 0;">Level Reached: <span id="final-score" style="color:#fbbf24; font-weight:bold;">0</span></p>
            
            <a id="share-link" href="#" target="_blank" class="btn-share">
                Share on Farcaster üü£
            </a>
            
            <button onclick="location.reload()" style="margin-top:20px; padding:10px 20px; background:none; border:1px solid #94a3b8; color:#94a3b8; border-radius:5px; cursor:pointer;">Try Again</button>
        </div>
    </div>

    <div id="controls">
        <div></div>
        <div class="btn-ctrl" ontouchstart="handleTouch(event, 0, -1)" onclick="move(0, -1)">‚¨ÜÔ∏è</div>
        <div></div>
        <div class="btn-ctrl" ontouchstart="handleTouch(event, -1, 0)" onclick="move(-1, 0)">‚¨ÖÔ∏è</div>
        <div class="btn-ctrl" ontouchstart="handleTouch(event, 0, 1)" onclick="move(0, 1)">‚¨áÔ∏è</div>
        <div class="btn-ctrl" ontouchstart="handleTouch(event, 1, 0)" onclick="move(1, 0)">‚û°Ô∏è</div>
    </div>

    <script>
        let level = 1;
        let size = 11; 
        const FIXED_TIME = 35;
        let timeLeft = FIXED_TIME;
        let timerInterval;
        let grid = [];
        let player = {x: 1, y: 1};
        let goal = {x: 9, y: 9};
        let isGameOver = false;

        function getCellSize() {
            const screenWidth = Math.min(window.innerWidth, 500); 
            const maxCellSize = Math.floor((screenWidth * 0.9) / size);
            return Math.min(maxCellSize, 25);
        }

        function generateMaze(s) {
            let maze = Array(s).fill().map(() => Array(s).fill(1));
            function carve(x, y) {
                maze[y][x] = 0;
                let directions = [[0, 2], [0, -2], [2, 0], [-2, 0]];
                directions.sort(() => Math.random() - 0.5); 
                for (let [dx, dy] of directions) {
                    let nx = x + dx, ny = y + dy;
                    if (ny > 0 && ny < s-1 && nx > 0 && nx < s-1 && maze[ny][nx] === 1) {
                        maze[y + dy/2][x + dx/2] = 0; 
                        carve(nx, ny);
                    }
                }
            }
            carve(1, 1);
            return maze;
        }

        function draw() {
            const gridEl = document.getElementById('grid');
            const cellSize = getCellSize();
            gridEl.style.gridTemplateColumns = `repeat(${size}, ${cellSize}px)`;
            gridEl.innerHTML = '';
            for(let y=0; y<size; y++) {
                for(let x=0; x<size; x++) {
                    const cell = document.createElement('div');
                    cell.style.width = `${cellSize}px`;
                    cell.style.height = `${cellSize}px`;
                    cell.classList.add('cell');
                    if (grid[y][x] === 1) cell.classList.add('wall');
                    if (x === player.x && y === player.y) cell.classList.add('player');
                    if (x === goal.x && y === goal.y) cell.classList.add('goal');
                    gridEl.appendChild(cell);
                }
            }
        }

        function handleTouch(e, dx, dy) {
            e.preventDefault(); 
            move(dx, dy);
        }

        function move(dx, dy) {
            if(isGameOver) return;
            let nx = player.x + dx;
            let ny = player.y + dy;
            if (grid[ny] && grid[ny][nx] === 0) {
                player.x = nx;
                player.y = ny;
                draw();
                checkWin();
            }
        }

        function checkWin() {
            if (player.x === goal.x && player.y === goal.y) {
                level++;
                size += 2; 
                timeLeft = FIXED_TIME;
                startGame();
            }
        }

        // --- KRƒ∞Tƒ∞K B√ñL√úM: PAYLA≈ûIM Lƒ∞NKƒ∞ AYARI ---
        function endGame() {
            isGameOver = true;
            clearInterval(timerInterval);
            
            // 1. Mevcut oyunun adresini (Vercel linkini) otomatik al
            const currentUrl = window.location.href;
            
            // 2. Payla≈üƒ±m metni
            const text = `I reached Level ${level} in Base Maze! üß© Can you beat the timer? @base`;
            
            // 3. Mini App v2 Linki (embeds parametresi ile)
            // embeds[] parametresi linkin "Frame" olarak g√∂r√ºnmesini saƒülar
            const shareUrl = `https://warpcast.com/~/compose?text=${encodeURIComponent(text)}&embeds[]=${encodeURIComponent(currentUrl)}`; 
            
            document.getElementById('share-link').href = shareUrl;
            document.getElementById('final-score').innerText = level;
            document.getElementById('modal').style.display = 'flex';
        }

        function startTimer() {
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timeLeft--;
                document.getElementById('time-display').innerText = timeLeft;
                if (timeLeft <= 0) endGame();
            }, 1000);
        }

        function startGame() {
            player = {x: 1, y: 1};
            goal = {x: size-2, y: size-2};
            grid = generateMaze(size);
            document.getElementById('level-display').innerText = level;
            draw();
            if(level === 1) startTimer();
        }

        window.addEventListener('keydown', (e) => {
            if(e.key === "ArrowUp") move(0, -1);
            if(e.key === "ArrowDown") move(0, 1);
            if(e.key === "ArrowLeft") move(-1, 0);
            if(e.key === "ArrowRight") move(1, 0);
        });

        window.addEventListener('resize', draw);

        startGame();
    </script>
</body>
</html>
