<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Base Maze - Mobile Fix</title>
    
    <meta property="fc:frame" content="vNext" />
    <meta property="fc:frame:image" content="https://cryptologos.cc/logos/base-base-logo.png" />
    <meta property="og:image" content="https://cryptologos.cc/logos/base-base-logo.png" />

    <style>
        * {
            box-sizing: border-box;
            -webkit-user-select: none; /* Chrome/Safari se√ßimi engelle */
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none; /* Yazƒ± se√ßimini engelle */
            -webkit-tap-highlight-color: transparent; /* Tƒ±klama rengini kapat */
        }

        body {
            background-color: #0f172a;
            color: white;
            font-family: 'Courier New', Courier, monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
            touch-action: none; /* Sayfa kaydƒ±rmayƒ± engelle */
        }

        #game-container {
            position: relative;
            border: 2px solid #334155;
            border-radius: 8px;
            padding: 2px;
            background: #1e293b;
            box-shadow: 0 0 15px rgba(0,0,0,0.5);
            /* Mobilde ekranƒ±n %95'ini kaplasƒ±n */
            max-width: 95vw;
            max-height: 50vh; 
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #grid {
            display: grid;
            gap: 0;
            /* Grid boyutlarƒ± JS ile ayarlanacak */
        }

        .cell {
            /* Boyut JS ile verilecek */
            background-color: #0f172a;
        }
        .wall { background-color: #475569; }
        
        /* Oyuncu ve Hedef stilleri */
        .player {
            background-color: #22c55e;
            border-radius: 50%;
            transform: scale(0.8); /* H√ºcreden biraz k√º√ß√ºk olsun */
            box-shadow: 0 0 5px #22c55e;
        }
        .goal {
            background-color: #fbbf24;
            transform: scale(0.8);
            box-shadow: 0 0 5px #fbbf24;
            animation: pulse 1s infinite;
        }

        #ui {
            width: 90%;
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 1.1rem;
            font-weight: bold;
        }
        .timer { color: #fbbf24; }
        .danger { color: #ef4444; }

        /* KONTROLLER (Daha b√ºy√ºk ve rahat) */
        #controls {
            margin-top: 15px;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            width: 200px; /* Sabit geni≈ülik */
        }

        .btn-ctrl {
            width: 60px;
            height: 60px;
            background: #334155;
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 0 #1e293b;
            active: transform: translateY(4px); /* Basma efekti */
        }
        .btn-ctrl:active {
            background: #2563eb;
            box-shadow: none;
            transform: translateY(4px);
        }

        /* MODAL */
        #modal {
            display: none;
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.9);
            z-index: 50;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 20px;
        }
        
        .btn-share {
            background-color: #855DCD;
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            text-decoration: none;
            font-weight: bold;
            margin-top: 15px;
            display: inline-block;
        }

        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.6; } 100% { opacity: 1; } }
    </style>
</head>
<body>

    <div id="ui">
        <span style="color: #3b82f6">Lvl <span id="level-display">1</span></span>
        <span class="timer">‚è≥ <span id="time-display">35</span>s</span>
    </div>

    <div id="game-container">
        <div id="grid"></div>
        
        <div id="modal">
            <h2 style="color: #ef4444; margin:0; font-size: 2rem;">GAME OVER</h2>
            <p>Score: Level <span id="final-score">0</span></p>
            <a id="share-link" href="#" target="_blank" class="btn-share">Share on Warpcast</a>
            <button onclick="location.reload()" style="margin-top:15px; padding:10px; background:none; border:1px solid white; color:white; border-radius:5px;">Try Again</button>
        </div>
    </div>

    <div id="controls">
        <div></div>
        <div class="btn-ctrl" ontouchstart="handleTouch(event, 0, -1)" onclick="move(0, -1)">‚¨ÜÔ∏è</div>
        <div></div>
        
        <div class="btn-ctrl" ontouchstart="handleTouch(event, -1, 0)" onclick="move(-1, 0)">‚¨ÖÔ∏è</div>
        <div class="btn-ctrl" ontouchstart="handleTouch(event, 0, 1)" onclick="move(0, 1)">‚¨áÔ∏è</div>
        <div class="btn-ctrl" ontouchstart="handleTouch(event, 1, 0)" onclick="move(1, 0)">‚û°Ô∏è</div>
    </div>

    <script>
        // --- AYARLAR ---
        let level = 1;
        let size = 11; 
        const FIXED_TIME = 35;
        let timeLeft = FIXED_TIME;
        let timerInterval;
        let grid = [];
        let player = {x: 1, y: 1};
        let goal = {x: 9, y: 9};
        let isGameOver = false;

        // --- MOBƒ∞L ƒ∞√áƒ∞N H√úCRE BOYUTU HESAPLA ---
        function getCellSize() {
            // Ekran geni≈üliƒüine g√∂re h√ºcre boyutu belirle
            // Ekranƒ±n %90'ƒ±nƒ±, labirent boyutuna (size) b√∂l√ºyoruz.
            const screenWidth = Math.min(window.innerWidth, 500); // Max 500px baz al
            const maxCellSize = Math.floor((screenWidth * 0.9) / size);
            return Math.min(maxCellSize, 25); // En fazla 25px olsun
        }

        // --- MAZE GENERATOR ---
        function generateMaze(s) {
            let maze = Array(s).fill().map(() => Array(s).fill(1));
            function carve(x, y) {
                maze[y][x] = 0;
                let directions = [[0, 2], [0, -2], [2, 0], [-2, 0]];
                directions.sort(() => Math.random() - 0.5); 
                for (let [dx, dy] of directions) {
                    let nx = x + dx, ny = y + dy;
                    if (ny > 0 && ny < s-1 && nx > 0 && nx < s-1 && maze[ny][nx] === 1) {
                        maze[y + dy/2][x + dx/2] = 0; 
                        carve(nx, ny);
                    }
                }
            }
            carve(1, 1);
            return maze;
        }

        // --- √áƒ∞Zƒ∞M (Responsive) ---
        function draw() {
            const gridEl = document.getElementById('grid');
            const cellSize = getCellSize();
            
            gridEl.style.gridTemplateColumns = `repeat(${size}, ${cellSize}px)`;
            gridEl.innerHTML = '';
            
            for(let y=0; y<size; y++) {
                for(let x=0; x<size; x++) {
                    const cell = document.createElement('div');
                    cell.style.width = `${cellSize}px`;
                    cell.style.height = `${cellSize}px`;
                    cell.classList.add('cell');
                    
                    if (grid[y][x] === 1) cell.classList.add('wall');
                    if (x === player.x && y === player.y) cell.classList.add('player');
                    if (x === goal.x && y === goal.y) cell.classList.add('goal');
                    
                    gridEl.appendChild(cell);
                }
            }
        }

        // --- MOBƒ∞L DOKUNMA Y√ñNETƒ∞Mƒ∞ ---
        function handleTouch(e, dx, dy) {
            e.preventDefault(); // √áift tƒ±klama zoom'unu engelle
            move(dx, dy);
        }

        // --- HAREKET ---
        function move(dx, dy) {
            if(isGameOver) return;
            let nx = player.x + dx;
            let ny = player.y + dy;
            if (grid[ny] && grid[ny][nx] === 0) {
                player.x = nx;
                player.y = ny;
                draw();
                checkWin();
            }
        }

        function checkWin() {
            if (player.x === goal.x && player.y === goal.y) {
                level++;
                size += 2; 
                timeLeft = FIXED_TIME;
                startGame();
            }
        }

        function endGame() {
            isGameOver = true;
            clearInterval(timerInterval);
            const text = `I reached Level ${level} in Base Maze! üß© Can you beat the timer? ‚è≥ @base`;
            const url = `https://warpcast.com/~/compose?text=${encodeURIComponent(text)}`; 
            document.getElementById('share-link').href = url;
            document.getElementById('final-score').innerText = level;
            document.getElementById('modal').style.display = 'flex';
        }

        function startTimer() {
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timeLeft--;
                document.getElementById('time-display').innerText = timeLeft;
                if (timeLeft <= 0) endGame();
            }, 1000);
        }

        function startGame() {
            player = {x: 1, y: 1};
            goal = {x: size-2, y: size-2};
            grid = generateMaze(size);
            document.getElementById('level-display').innerText = level;
            draw();
            if(level === 1) startTimer();
        }

        // Klavye (PC i√ßin)
        window.addEventListener('keydown', (e) => {
            if(e.key === "ArrowUp") move(0, -1);
            if(e.key === "ArrowDown") move(0, 1);
            if(e.key === "ArrowLeft") move(-1, 0);
            if(e.key === "ArrowRight") move(1, 0);
        });

        // Ekran d√∂nd√ºr√ºl√ºrse labirenti yeniden boyutlandƒ±r
        window.addEventListener('resize', draw);

        startGame();
    </script>
</body>
</html>
